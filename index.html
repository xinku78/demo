<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo</title>
    <style>
      h2 {
        font-size: 36px;
        text-align: center;
      }
      #msg {
        font-size: 18px;
        text-align: center;
        color: red;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <h2>Demo Application</h2>
    <p id="msg"></p>

    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", () => {
        const msg = document.getElementById("msg");
        var appScheme = "xkdemo://xinku78.github.io/demo";
        var fallbackUrl = "./app-release.apk"; // Replace with your app's Play Store URL
        var timeout;
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        var isAndroid = /android/i.test(userAgent);
        // Function to generate a random alphanumeric string
        var generateRandomString = function (length) {
          var result = "";
          var characters =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
          var charactersLength = characters.length;
          for (var i = 0; i < length; i++) {
            result += characters.charAt(
              Math.floor(Math.random() * charactersLength)
            );
          }
          return result;
        };
        // Function to check if URL has query parameters
        var urlHasQueryParams = function (url) {
          return url.indexOf("?") !== -1;
        };
        var addQueryParamToCurrentUrl = function (paramName, paramValue) {
          var currentUrl = window.location.href;
          var separator = urlHasQueryParams(currentUrl) ? "&" : "?";
          var newUrl =
            currentUrl +
            separator +
            encodeURIComponent(paramName) +
            "=" +
            encodeURIComponent(paramValue);
          return newUrl;
        };
        if (!urlHasQueryParams(window.location.href)) {
          var updatedUrl = addQueryParamToCurrentUrl("random", generateRandomString(64));
          window.history.replaceState({}, document.title, updatedUrl);
        }
        // Function to check if the app is installed
        var checkIfInstalled = function () {
          window.location.href = appScheme; 
        };
        

        // Function to handle the fallback
        var handleFallback = function () {
          msg.innerText = "Opening fallback URL...";
          window.location.href = fallbackUrl;
        };

        if (isAndroid) {
          checkIfInstalled();
          timeout = setTimeout(handleFallback, 3000); // Adjust the timeout value if needed

          // Attempt to open the app
        } else {
          msg.innerText = "Error: Try on mobile";
        }

        // Clear the timeout if the app is opened successfully
        window.onblur = function () {
          clearTimeout(timeout);
        };
      });
    </script>
  </body>
</html>
